<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Big Brother is Watching You</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #000;
            color: #fff;
            overflow-x: hidden;
        }

        .static-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                rgba(255, 255, 255, 0.03) 0px,
                rgba(255, 255, 255, 0.03) 1px,
                transparent 1px,
                transparent 2px
            );
            pointer-events: none;
            animation: staticMove 0.1s infinite;
            z-index: 1;
        }

        @keyframes staticMove {
            0% { transform: translateY(0); }
            100% { transform: translateY(2px); }
        }

        .glitch-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 80px 20px;
            position: relative;
        }

        .big-brother-eye {
            width: 200px;
            height: 200px;
            margin: 0 auto 30px;
            border: 5px solid #e94560;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: radial-gradient(circle, #e94560 0%, #000 70%);
            animation: eyePulse 3s infinite;
            position: relative;
            z-index: 2;
        }

        @keyframes eyePulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 30px #e94560; }
            50% { transform: scale(1.1); box-shadow: 0 0 60px #e94560; }
        }

        @keyframes textPulse {
            0%, 100% { 
                text-shadow: 0 0 10px #e94560, 0 0 20px #e94560; 
                transform: scale(1);
            }
            50% { 
                text-shadow: 0 0 20px #e94560, 0 0 40px #e94560, 0 0 60px #e94560; 
                transform: scale(1.05);
            }
        }

        .pupil {
            width: 80px;
            height: 80px;
            background: #000;
            border-radius: 50%;
            border: 3px solid #fff;
        }

        .glitch-text {
            font-size: 72px;
            font-weight: bold;
            text-align: center;
            position: relative;
            color: #e94560;
            z-index: 2;
            margin-bottom: 50px;
            font-family: 'Courier New', monospace;
            animation: textPulse 3s infinite;
            image-rendering: pixelated;
        }

        .glitch-text[style*="font-size: 48px;"] {
            color: #e94560 !important;
        }

        .glitch-text::before,
        .glitch-text::after {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .glitch-text::before {
            color: #ff0000;
            animation: glitch1 0.8s infinite;
            clip-path: polygon(0 0, 100% 0, 100% 45%, 0 45%);
            image-rendering: pixelated;
            filter: blur(0.5px);
        }

        .glitch-text::after {
            color: #000000;
            animation: glitch2 0.8s infinite;
            clip-path: polygon(0 55%, 100% 55%, 100% 100%, 0 100%);
            image-rendering: pixelated;
            filter: blur(0.5px);
        }

        @keyframes glitch1 {
            0%, 100% { 
                transform: translate(0); 
                opacity: 0.8;
            }
            20% { 
                transform: translate(-3px, 3px); 
                opacity: 0.9;
            }
            40% { 
                transform: translate(3px, -3px); 
                opacity: 0.7;
            }
            60% { 
                transform: translate(-2px, -2px); 
                opacity: 0.85;
            }
            80% { 
                transform: translate(2px, 2px); 
                opacity: 0.75;
            }
        }

        @keyframes glitch2 {
            0%, 100% { 
                transform: translate(0); 
                opacity: 0.8;
            }
            25% { 
                transform: translate(3px, -3px); 
                opacity: 0.9;
            }
            45% { 
                transform: translate(-3px, 3px); 
                opacity: 0.7;
            }
            65% { 
                transform: translate(2px, 2px); 
                opacity: 0.85;
            }
            85% { 
                transform: translate(-2px, -2px); 
                opacity: 0.75;
            }
        }

        .propaganda-box {
            max-width: 700px;
            background: rgba(255, 255, 255, 0.05);
            border: 3px solid #fff;
            padding: 40px;
            text-align: center;
            z-index: 2;
            position: relative;
            animation: boxPulse 3s infinite;
        }

        @keyframes boxPulse {
            0%, 100% { 
                box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 30px rgba(255, 255, 255, 0.6), 0 0 50px rgba(255, 0, 0, 0.3);
                transform: scale(1.02);
            }
        }

        .propaganda-box h2 {
            font-size: 36px;
            margin-bottom: 20px;
            color: #ff0000;
            animation: headerPulse 3s infinite;
        }

        @keyframes headerPulse {
            0%, 100% { 
                text-shadow: 0 0 5px #ff0000;
            }
            50% { 
                text-shadow: 0 0 15px #ff0000, 0 0 25px #ff0000;
            }
        }

        .propaganda-box ul {
            list-style: none;
            font-size: 20px;
            line-height: 2;
        }

        .propaganda-box li::before {
            content: "\25B6 ";
            color: #ff0000;
        }

        .visitor-panel {
            margin-top: 25px;
            padding: 14px 18px;
            background: linear-gradient(135deg, #ff0000 0%, #cc0000 100%);
            color: #000;
            font-weight: bold;
            font-size: 13px;
            z-index: 2;
            position: relative;
            border-radius: 4px;
            display: grid;
            grid-template-columns: auto 1fr;
            grid-row-gap: 4px;
            grid-column-gap: 14px;
            box-shadow: 0 2px 8px rgba(255, 0, 0, 0.4);
            line-height: 1.5;
        }

        .visitor-panel-title {
            grid-column: 1 / -1;
            font-size: 14px;
            margin-bottom: 4px;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            border-bottom: 1px solid rgba(0, 0, 0, 0.2);
            padding-bottom: 4px;
        }

        .visitor-label {
            opacity: 0.8;
            text-align: right;
            font-size: 12px;
        }

        .visitor-value {
            text-align: left;
            font-size: 12px;
        }

        .trust-level-container {
            margin-top: 25px;
            padding: 16px;
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(255, 0, 0, 0.6);
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(255, 0, 0, 0.3);
        }

        .trust-level-label {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #ff0000;
            text-shadow: 0 0 8px #ff0000;
            letter-spacing: 0.12em;
            text-transform: uppercase;
        }

        .trust-level-bar {
            width: 100%;
            height: 26px;
            background: #0a0a0a;
            border: 2px solid #ff0000;
            position: relative;
            overflow: hidden;
            border-radius: 3px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.6);
        }

        .trust-level-fill {
            height: 100%;
            background: linear-gradient(90deg, #dc2626 0%, #ef4444 50%, #f87171 100%);
            transition: width 0.8s ease-out, background 0.8s ease-out;
            position: relative;
            box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
        }

        .trust-level-fill.high-compliance {
            background: linear-gradient(90deg, #22c55e 0%, #84cc16 50%, #facc15 100%);
            box-shadow: 0 0 10px rgba(34, 197, 94, 0.5);
        }

        .trust-level-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
            font-size: 13px;
            color: #fff;
            text-shadow: 1px 1px 3px #000;
            z-index: 1;
            letter-spacing: 0.05em;
        }

        .assessment-log {
            margin-top: 8px;
            padding: 8px 10px;
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid rgba(255, 0, 0, 0.3);
            border-radius: 2px;
            font-size: 11px;
            font-weight: bold;
            color: #ffcccc;
            text-align: center;
            font-family: 'Courier New', monospace;
            letter-spacing: 0.03em;
            min-height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .assessment-log.positive {
            color: #86efac;
            border-color: rgba(34, 197, 94, 0.3);
            background: rgba(34, 197, 94, 0.1);
        }

        .assessment-log.negative {
            color: #fca5a5;
            border-color: rgba(239, 68, 68, 0.4);
            background: rgba(239, 68, 68, 0.15);
        }


        .test-container {
            margin-top: 25px;
            padding: 18px 18px 20px;
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid rgba(255, 0, 0, 0.7);
            border-radius: 4px;
            text-align: left;
        }

        .test-title {
            font-size: 16px;
            font-weight: bold;
            color: #ff0000;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            margin-bottom: 6px;
        }

        .test-subtitle {
            font-size: 12px;
            color: #ffcccc;
            margin-bottom: 12px;
            line-height: 1.5;
        }

        .test-question {
            margin-bottom: 10px;
            font-size: 13px;
            display: none;
        }

        .test-question.active {
            display: block;
        }

        .test-question-text {
            font-weight: bold;
            margin-bottom: 4px;
        }

        .test-options {
            display: flex;
            flex-direction: column;
            gap: 2px;
            font-size: 12px;
        }

        .test-options label {
            cursor: pointer;
        }

        .test-options input[type="radio"] {
            margin-right: 6px;
        }

        .test-progress {
            margin-top: 8px;
            font-size: 11px;
            color: #ffcccc;
            font-family: 'Courier New', monospace;
        }

        #submitTestBtn {
            margin-top: 10px;
            width: 100%;
            padding: 10px;
            background: #e11d48;
            border: none;
            color: #000;
            font-weight: bold;
            font-size: 13px;
            text-transform: uppercase;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            letter-spacing: 0.08em;
            transition: background 0.3s, box-shadow 0.3s;
        }

        #submitTestBtn:hover {
            background: #be123c;
            box-shadow: 0 0 12px rgba(248, 113, 113, 0.7);
        }

        #submitTestBtn:disabled {
            background: #4b5563;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .test-result {
            margin-top: 10px;
            padding: 10px;
            border: 1px solid rgba(255, 0, 0, 0.5);
            background: rgba(0, 0, 0, 0.7);
            font-size: 12px;
            line-height: 1.5;
        }

        .test-result strong {
            color: #fca5a5;
        }

        .newspeak-tag {
            display: inline-block;
            margin-top: 4px;
            padding: 2px 6px;
            border-radius: 2px;
            background: rgba(248, 113, 113, 0.15);
            border: 1px solid rgba(248, 113, 113, 0.6);
            font-size: 10px;
            letter-spacing: 0.12em;
            text-transform: uppercase;
        }

        .upload-container {
            margin-top: 25px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.6);
            border: 2px dashed #ff0000;
        }

        .upload-label {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #ff0000;
            text-transform: uppercase;
        }

        .upload-help {
            margin-top: 8px;
            font-size: 12px;
            color: #ffcccc;
            font-style: italic;
        }

        #complianceUpload {
            width: 100%;
            padding: 8px;
            background: #111;
            border: 1px solid #ff0000;
            color: #fff;
            margin-bottom: 12px;
        }

        #analyzeEvidenceBtn {
            width: 100%;
            padding: 12px;
            background: #ff0000;
            color: #000;
            border: none;
            font-weight: bold;
            font-size: 16px;
            text-transform: uppercase;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            letter-spacing: 1px;
            transition: all 0.3s;
        }

        #analyzeEvidenceBtn:hover {
            background: #cc0000;
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.6);
        }

        #analyzeEvidenceBtn:disabled {
            background: #666;
            cursor: not-allowed;
            opacity: 0.5;
        }

        .scanning-progress {
            margin-top: 12px;
            padding: 10px;
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid #ff0000;
            font-size: 13px;
            font-weight: bold;
            color: #ff0000;
            text-align: center;
            display: none;
        }

        @keyframes scanPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        .scanning-progress.active {
            display: block;
            animation: scanPulse 0.8s infinite;
        }

        .evidence-gallery {
            margin-top: 25px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid #ff0000;
            display: none;
        }

        .evidence-gallery.has-images {
            display: block;
        }

        .gallery-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #ff0000;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }

        .gallery-item {
            position: relative;
            aspect-ratio: 1;
            overflow: hidden;
            border: 2px solid #ff0000;
            background: #000;
            box-shadow: 0 0 10px rgba(255, 0, 0, 0.3);
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }

        .gallery-item:hover img {
            transform: scale(1.1);
        }

        .gallery-item-timestamp {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.85);
            color: #ff0000;
            font-size: 9px;
            padding: 4px;
            text-align: center;
            font-weight: bold;
            letter-spacing: 0.05em;
        }

        @media (max-width: 768px) {
            .glitch-text {
                font-size: 36px;
            }

            .propaganda-box {
                padding: 20px;
            }

            .propaganda-box h2 {
                font-size: 24px;
            }

            .propaganda-box ul {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="static-overlay"></div>
    <div class="glitch-container">
        <div class="big-brother-eye">
            <div class="pupil"></div>
        </div>

        <h1 class="glitch-text" data-text="BIG BROTHER">BIG BROTHER</h1>
        <h1 class="glitch-text" data-text="IS WATCHING YOU" style="font-size: 48px;">IS WATCHING YOU</h1>

        <div class="propaganda-box">
            <h2>YOU HAVE BEEN IDENTIFIED</h2>
            <div class="visitor-panel">
                <div class="visitor-panel-title">CITIZEN METADATA</div>
                <div class="visitor-label">IP ADDRESS</div>
                <div class="visitor-value" id="ipAddress">DETECTING...</div>
                <div class="visitor-label">LOCATION</div>
                <div class="visitor-value" id="location">DETECTING...</div>
                <div class="visitor-label">DEVICE TYPE</div>
                <div class="visitor-value" id="deviceType">DETECTING...</div>
                <div class="visitor-label">LAST SEEN AT</div>
                <div class="visitor-value" id="lastSeen">DETECTING...</div>
            </div>
            <p>

            </p>
            <ul>
                <li>Your location has been logged</li>
                <li>Your device has been registered</li>
                <li>Your compliance is appreciated</li>
                <li>Doubleplusungood thoughts detected</li>
            </ul>


            <div class="trust-level-container">
                <div class="trust-level-label">COMPLIANCE SCORE</div>
                <div class="trust-level-bar">
                    <div class="trust-level-fill" id="trustFill" style="width: 0%;">
                        <div class="trust-level-text" id="trustText">0%</div>
                    </div>
                </div>
                <div class="assessment-log" id="assessmentLog">AWAITING EVIDENCE SUBMISSION...</div>
                <div id="complianceWarning" style="margin-top: 10px; font-size: 12px; font-weight: bold; color: #ff6b6b; text-transform: uppercase; letter-spacing: 0.08em; line-height: 1.4;">
                    AWAITING INITIAL ASSESSMENT...
                </div>
            </div>


            <div class="test-container">
                <div class="test-title">PSYCHOMETRIC LOYALTY INDEX</div>
                <div class="test-subtitle">
                    Answer a brief Myers-Briggs style inventory translated into Newspeak.
                    Your pattern of goodthink versus potential crimethink will adjust your compliance score.
                </div>
                <form id="personalityTestForm">
                    <div id="testQuestions"></div>
                    <button type="button" id="submitTestBtn">Submit Profile For Evaluation</button>
                    <div class="test-progress" id="testProgress">0 / 0 QUESTIONS ANSWERED</div>
                    <div class="test-result" id="testResult"></div>
                </form>
            </div>

            <div class="upload-container">
                <div class="upload-label">SUBMIT EVIDENCE OF COMPLIANCE</div>
                <input type="file" id="complianceUpload" accept="image/*" multiple>
                <button id="analyzeEvidenceBtn">Analyze Evidence</button>
                <div class="scanning-progress" id="scanningProgress">SCANNING EVIDENCE...</div>
                <div class="upload-help">Recommended evidence: photos of you enthusiastically consuming state-approved media, attending patriotic rallies, displaying official slogans, or posing with sanctioned symbols.<br>Do not upload private or sensitive real-world documents; this interface is a fictional compliance simulator.</div>
            </div>

            <div class="evidence-gallery" id="evidenceGallery">
                <div class="gallery-title">ARCHIVED EVIDENCE</div>
                <div class="gallery-grid" id="galleryGrid"></div>
            </div>
        </div>
    </div>

    <script>
        // Fetch IP address
        async function fetchIPAddress() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                document.getElementById('ipAddress').textContent = data.ip;
                fetchLocation(data.ip);
            } catch (error) {
                document.getElementById('ipAddress').textContent = 'UNKNOWN';
                document.getElementById('location').textContent = 'UNKNOWN';
            }
        }

        // Fetch approximate location from IP
        async function fetchLocation(ip) {
            try {
                const response = await fetch(`https://ipapi.co/${ip}/json/`);
                const data = await response.json();

                if (data && !data.error) {
                    const parts = [data.city, data.region, data.country_name].filter(Boolean);
                    document.getElementById('location').textContent = parts.join(', ') || 'UNKNOWN';
                } else {
                    document.getElementById('location').textContent = 'UNKNOWN';
                }
            } catch (error) {
                document.getElementById('location').textContent = 'UNKNOWN';
            }
        }

        // Detect device type
        function detectDeviceType() {
            const ua = navigator.userAgent || navigator.vendor || window.opera;
            let type = 'DESKTOP';

            if (/android/i.test(ua)) {
                type = 'ANDROID DEVICE';
            } else if (/iPad|Tablet/i.test(ua)) {
                type = 'TABLET';
            } else if (/iPhone|iPod/i.test(ua)) {
                type = 'IPHONE';
            } else if (/Mobile/i.test(ua)) {
                type = 'MOBILE DEVICE';
            } else if (/Macintosh/i.test(ua)) {
                type = 'MAC DESKTOP';
            } else if (/Windows/i.test(ua)) {
                type = 'WINDOWS DESKTOP';
            }

            document.getElementById('deviceType').textContent = type;
        }

        // Display current timestamp
        function displayLastSeen() {
            const now = new Date();
            const formatted = now.toLocaleString('en-US', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            });
            document.getElementById('lastSeen').textContent = formatted;
        }

        let currentComplianceLevel = 0;

        const personalityQuestions = [
            {
                id: 'q1',
                axis: 'EI',
                text: 'At the daily Two Minutes Hate, you are most likely to...',
                options: [
                    {
                        value: 'E',
                        label: 'Lead the chanting, raise your fist, and shout the slogans doubleplusloud (doubleplusgood).',
                        complianceDelta: 3
                    },
                    {
                        value: 'I',
                        label: 'Stand at the edge, repeating the words quietly while observing the crowd.',
                        complianceDelta: -1
                    }
                ]
            },
            {
                id: 'q2',
                axis: 'SN',
                text: 'When given access to the archives, you prefer to...',
                options: [
                    {
                        value: 'S',
                        label: 'Review clear lists of production quotas and approved statistics from the Ministry of Plenty.',
                        complianceDelta: 3
                    },
                    {
                        value: 'N',
                        label: 'Search for patterns, rumors, and interesting oldspeak fragments between the lines.',
                        complianceDelta: -3
                    }
                ]
            },
            {
                id: 'q3',
                axis: 'TF',
                text: 'A comrade makes a borderline remark during a broadcast.',
                options: [
                    {
                        value: 'T',
                        label: 'Evaluate the remark logically and report if it matches written crimethink criteria.',
                        complianceDelta: 2
                    },
                    {
                        value: 'F',
                        label: 'Consider the comrade feelings and decide whether reporting would feel doubleplusungood.',
                        complianceDelta: -2
                    }
                ]
            },
            {
                id: 'q4',
                axis: 'JP',
                text: 'How do you approach your daily victory schedule?',
                options: [
                    {
                        value: 'J',
                        label: 'Follow the posted timetable exactly, ticking each goodthink task as completed.',
                        complianceDelta: 3
                    },
                    {
                        value: 'P',
                        label: 'Prefer a flexible day where Party events fit around your own stream of thought.',
                        complianceDelta: -2
                    }
                ]
            },
            {
                id: 'q5',
                axis: 'EI',
                text: 'At a Victory Gin canteen, you usually...',
                options: [
                    {
                        value: 'E',
                        label: 'Move table to table, sharing fresh slogans and starting loud toasts to Big Brother.',
                        complianceDelta: 2
                    },
                    {
                        value: 'I',
                        label: 'Stay with a small trusted group and listen more than you speak.',
                        complianceDelta: -1
                    }
                ]
            },
            {
                id: 'q6',
                axis: 'SN',
                text: 'During a state broadcast, you pay most attention to...',
                options: [
                    {
                        value: 'S',
                        label: 'Official numbers, uniforms, and visible order on the screen.',
                        complianceDelta: 2
                    },
                    {
                        value: 'N',
                        label: 'Tone, hidden meanings, and small glitches that hint at reality behind the telescreen.',
                        complianceDelta: -3
                    }
                ]
            },
            {
                id: 'q7',
                axis: 'TF',
                text: 'If ordered to support a policy that sends many citizens to joycamp, you...',
                options: [
                    {
                        value: 'T',
                        label: 'Calculate how it improves efficiency and stability for the whole system.',
                        complianceDelta: 1
                    },
                    {
                        value: 'F',
                        label: 'Worry first about individual suffering, even if the policy is called doubleplusnecessary.',
                        complianceDelta: -3
                    }
                ]
            },
            {
                id: 'q8',
                axis: 'JP',
                text: 'When asked to prepare a poster for Hate Week, you...',
                options: [
                    {
                        value: 'J',
                        label: 'Carefully follow design guidelines, using only approved Newspeak and Party colors.',
                        complianceDelta: 3
                    },
                    {
                        value: 'P',
                        label: 'Experiment with creative layouts and playful oldspeak phrases to catch attention.',
                        complianceDelta: -3
                    }
                ]
            }
        ];

        const NEWSPEAK_TYPE_LABELS = {
            ISTJ: 'DOUBLEPLUSDUTIFUL ARCHIVIST',
            ISFJ: 'GOODTHINKFUL CARETAKER',
            INFJ: 'VISIONARY GOODTHINKER (POTENTIAL CRIMETHINK IF UNSUPERVISED)',
            INTJ: 'STRATEGIC CRIMETHINK RISK',
            ISTP: 'PRACTICAL MECHANIC OF REALITYCONTROL',
            ISFP: 'QUIET JOYCAMP COMPANION',
            INFP: 'DREAMFUL OLDSPEAK ROMANTIC',
            INTP: 'LOGIC-DRUNK CRIMETHINK ENGINE',
            ESTP: 'HATE-RALLY INSTIGATOR',
            ESFP: 'PROLEFEED ENTERTAINER',
            ENFP: 'DOUBLEPLUSWARM AGITATOR',
            ENTP: 'IDEA-WRANGLER, HIGH THOUGHTCRIME INDEX',
            ESTJ: 'MINISTRY-APPROVED ORGANIZER',
            ESFJ: 'PARTY SOCIAL-COORDINATOR',
            ENFJ: 'CHARISMATIC GOODTHINK TRAINER',
            ENTJ: 'INNER PARTY COMMAND MATERIAL'
        };


        function updateComplianceWarning() {
            const warningEl = document.getElementById('complianceWarning');
            const fillEl = document.getElementById('trustFill');
            if (!warningEl) return;

            const messages = [
                'SUBJECT UNREGISTERED: MAXIMUM THREAT CLASSIFICATION IN EFFECT.', // 0–4%
                'HOSTILE ENTITY: PERMANENT SURVEILLANCE AUTHORIZED.', // 5–9%
                'EXTREME THOUGHTCRIME RISK: DETENTION PROTOCOLS ARMED.', // 10–14%
                'CRITICAL THREAT: IMMEDIATE INTERROGATION RECOMMENDED.', // 15–19%
                'HIGH RISK: MANDATORY RE-EDUCATION SCHEDULED.', // 20–24%
                'UNSTABLE LOYALTY: PROPAGANDA DOSAGE INCREASED.', // 25–29%
                'DEFICIENT COMPLIANCE: BEHAVIORAL ADJUSTMENT IN PROGRESS.', // 30–34%
                'BORDERLINE TRUSTWORTHY: CLOSE MONITORING ACTIVE.', // 35–39%
                'LOW COMPLIANCE: ADDITIONAL REPORTING REQUIRED.', // 40–44%
                'NEUTRAL STATUS: CONTINUED OBSERVATION ADVISED.', // 45–49%
                'AVERAGE CITIZEN: LOYALTY UNDER REVIEW.', // 50–54%
                'MODERATE COMPLIANCE: MAINTAIN PUBLIC ENTHUSIASM LEVELS.', // 55–59%
                'PROVISIONALLY TRUSTED: LIMITED PRIVILEGES MAY APPLY.', // 60–64%
                'RELIABLE CITIZEN: MINISTRY APPROVAL NOTED.', // 65–69%
                'PREFERRED CITIZEN: EXEMPLARY PUBLIC BEHAVIOR RECORDED.', // 70–74%
                'HIGH VALUE CITIZEN: INNER SLOGAN ACCESS GRANTED.', // 75–79%
                'PRIORITY LOYALIST: SURVEILLANCE LOAD PARTIALLY REDUCED.', // 80–84%
                'DISTINGUISHED SUPPORTER: INNER PARTY OBSERVES WITH APPROVAL.', // 85–89%
                'ELITE COMPLIER: PROPAGANDA MODEL STATUS ACHIEVED.', // 90–94%
                'EXEMPLARY: MODEL CITIZEN. BIG BROTHER SMILES UPON YOU.', // 95–99%
                'ABSOLUTE LOYALTY: THOUGHT AND ACTION FULLY ALIGNED WITH THE PARTY.' // 100%
            ];

            const index = Math.min(
                messages.length - 1,
                Math.max(0, Math.floor(currentComplianceLevel / 5))
            );

            warningEl.textContent = messages[index];

            // Update bar color based on compliance level
            if (currentComplianceLevel >= 60) {
                fillEl.classList.add('high-compliance');
            } else {
                fillEl.classList.remove('high-compliance');
            }
        }

        function setComplianceLevel(level) {
            const fillElement = document.getElementById('trustFill');
            const textElement = document.getElementById('trustText');
            currentComplianceLevel = Math.max(0, Math.min(100, level));
            fillElement.style.width = currentComplianceLevel + '%';
            textElement.textContent = currentComplianceLevel + '%';
            updateComplianceWarning();
        }


        let currentQuestionIndex = 0;

        function renderPersonalityTest() {
            const container = document.getElementById('testQuestions');
            if (!container || !Array.isArray(personalityQuestions)) return;

            let html = '';
            personalityQuestions.forEach((q, index) => {
                const activeClass = index === 0 ? ' active' : '';
                html += `
                    <div class="test-question${activeClass}" data-question-id="${q.id}" data-question-index="${index}">
                        <div class="test-question-text">Q${index + 1}. ${q.text}</div>
                        <div class="test-options">
                `;

                if (Array.isArray(q.options)) {
                    q.options.forEach((opt, optIndex) => {
                        const inputId = `${q.id}_${optIndex}`;
                        html += `
                            <label>
                                <input type="radio"
                                       name="${q.id}"
                                       id="${inputId}"
                                       value="${opt.value}"
                                       data-axis="${q.axis}"
                                       data-compliance="${opt.complianceDelta}">
                                ${opt.label}
                            </label>
                        `;
                    });
                }

                html += `
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function showNextQuestion() {
            const questions = document.querySelectorAll('.test-question');
            if (currentQuestionIndex < questions.length - 1) {
                questions[currentQuestionIndex].classList.remove('active');
                currentQuestionIndex++;
                questions[currentQuestionIndex].classList.add('active');
            }
        }

        function updateTestProgress() {
            const form = document.getElementById('personalityTestForm');
            const progressEl = document.getElementById('testProgress');
            if (!form || !progressEl || !Array.isArray(personalityQuestions)) return;

            let answered = 0;
            personalityQuestions.forEach(q => {
                const selected = form.querySelector('input[name="' + q.id + '"]:checked');
                if (selected) {
                    answered += 1;
                }
            });

            const total = personalityQuestions.length;
            progressEl.textContent = answered + ' / ' + total + ' QUESTIONS ANSWERED';
        }

        function handlePersonalitySubmit() {
            const form = document.getElementById('personalityTestForm');
            const resultEl = document.getElementById('testResult');
            if (!form || !resultEl || !Array.isArray(personalityQuestions)) return;

            const scores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
            let totalDelta = 0;
            let unanswered = 0;

            personalityQuestions.forEach(q => {
                const selected = form.querySelector('input[name="' + q.id + '"]:checked');
                if (!selected) {
                    unanswered += 1;
                    return;
                }
                const letter = selected.value;
                const complianceDelta = parseInt(selected.getAttribute('data-compliance') || '0', 10);
                if (scores.hasOwnProperty(letter)) {
                    scores[letter] += 1;
                }
                totalDelta += complianceDelta;
            });

            if (unanswered > 0) {
                resultEl.innerHTML = '<span style="color:#fca5a5;">INCOMPLETE PROFILE: ANSWER ALL QUESTIONS BEFORE SUBMISSION.</span>';
                return;
            }

            const typeLetters = [
                scores.E >= scores.I ? 'E' : 'I',
                scores.S >= scores.N ? 'S' : 'N',
                scores.T >= scores.F ? 'T' : 'F',
                scores.J >= scores.P ? 'J' : 'P'
            ];
            const type = typeLetters.join('');

            const profileLabel = NEWSPEAK_TYPE_LABELS[type] || 'UNCLASSIFIABLE PERSONALITY PATTERN';
            const clampedDelta = Math.max(-20, Math.min(20, totalDelta));
            const before = currentComplianceLevel;
            const after = Math.max(0, Math.min(100, before + clampedDelta));

            setComplianceLevel(after);

            let deltaText;
            if (clampedDelta > 0) {
                deltaText = 'Compliance score increased by ' + clampedDelta + '%.';
            } else if (clampedDelta < 0) {
                deltaText = 'Compliance score decreased by ' + Math.abs(clampedDelta) + '%.';
            } else {
                deltaText = 'No change to compliance score. Profile marked for continued observation.';
            }

            resultEl.innerHTML =
                '<div><strong>Psychometric designation:</strong> ' + type + '</div>' +
                '<div><strong>Newspeak profile:</strong> ' + profileLabel + '</div>' +
                '<div style="margin-top:6px;">' + deltaText + '</div>' +
                '<div class="newspeak-tag">GOODTHINK INDEX UPDATED</div>';

            const logEl = document.getElementById('assessmentLog');
            if (logEl) {
                const sign = clampedDelta >= 0 ? '+' : '';
                const action = clampedDelta >= 0
                    ? 'PSYCHOMETRIC PROFILE ALIGNS WITH GOODTHINK'
                    : 'TRAITS FLAGGED FOR POTENTIAL CRIMETHINK';
                logEl.textContent = 'Last Assessment: ' + sign + clampedDelta + '% (PERSONALITY TEST  ' + type + ')';
                logEl.className = 'assessment-log ' + (clampedDelta >= 0 ? 'positive' : 'negative');
            }
        }

        // Initial compliance score (ominously low)
        function initialComplianceLevel() {
            const level = Math.floor(Math.random() * 31) + 15; // 15-45%
            setTimeout(() => setComplianceLevel(level), 500);
        }

        // Recalculate compliance when evidence is analyzed
        async function recalculateComplianceFromEvidence() {
            const input = document.getElementById('complianceUpload');
            const files = input ? input.files : null;
            const btn = document.getElementById('analyzeEvidenceBtn');
            const scanProgress = document.getElementById('scanningProgress');

            if (!files || files.length === 0) {
                alert('NO EVIDENCE DETECTED. SUBMIT VISUAL PROOF OF LOYALTY.');
                return;
            }

            // Disable button and show scanning state
            btn.disabled = true;
            scanProgress.classList.add('active');
            scanProgress.textContent = 'SCANNING EVIDENCE...';

            const count = files.length;

            // Simulate scanning phases
            await new Promise(resolve => setTimeout(resolve, 800));
            scanProgress.textContent = `ANALYZING ${count} IMAGE${count > 1 ? 'S' : ''}...`;

            await new Promise(resolve => setTimeout(resolve, 1000));
            scanProgress.textContent = 'CROSS-REFERENCING WITH MINISTRY DATABASE...';

            await new Promise(resolve => setTimeout(resolve, 900));
            scanProgress.textContent = 'CALCULATING LOYALTY QUOTIENT...';

            // Calculate score impact based on number of photos
            // More photos = larger possible swing (up or down)
            let maxDelta = 12;
            if (count === 1) {
                maxDelta = 12;
            } else if (count === 2) {
                maxDelta = 18;
            } else if (count === 3) {
                maxDelta = 24;
            } else if (count === 4) {
                maxDelta = 30;
            } else if (count >= 5) {
                maxDelta = 36;
            }

            const roll = Math.random();
            let delta = 0;

            // ~30% chance that the submitted evidence is suspicious and reduces the score
            if (roll < 0.3) {
                const penaltyMin = 4;
                const penaltyMax = Math.max(penaltyMin + 2, Math.floor(maxDelta * 0.8));
                const penalty = Math.floor(Math.random() * (penaltyMax - penaltyMin + 1)) + penaltyMin;
                delta = -penalty;
            } else {
                const bonusMin = Math.max(3, Math.floor(maxDelta * 0.35));
                const bonusMax = maxDelta;
                delta = Math.floor(Math.random() * (bonusMax - bonusMin + 1)) + bonusMin;
            }

            const newLevel = Math.max(0, Math.min(100, currentComplianceLevel + delta));

            await new Promise(resolve => setTimeout(resolve, 700));
            scanProgress.textContent = 'ASSESSMENT COMPLETE. UPDATING RECORDS...';

            await new Promise(resolve => setTimeout(resolve, 500));

            // Update the score
            setComplianceLevel(newLevel);

            // Update assessment log
            const logEl = document.getElementById('assessmentLog');
            if (logEl) {
                const sign = delta >= 0 ? '+' : '';
                const action = delta >= 0 ? 'LOYALTY EVIDENCE ACCEPTED' : 'SUSPICIOUS CONTENT FLAGGED';
                logEl.textContent = `Last Assessment: ${sign}${delta}% (${action})`;
                logEl.className = 'assessment-log ' + (delta >= 0 ? 'positive' : 'negative');
            }

            // Add images to gallery
            addImagesToGallery(files);

            // Hide scanning and re-enable button
            scanProgress.classList.remove('active');
            btn.disabled = false;
        }

        function addImagesToGallery(files) {
            const gallery = document.getElementById('evidenceGallery');
            const grid = document.getElementById('galleryGrid');

            if (!gallery || !grid) return;

            // Show gallery
            gallery.classList.add('has-images');

            // Add each image
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const reader = new FileReader();

                reader.onload = function(e) {
                    const now = new Date();
                    const timestamp = now.toLocaleString('en-US', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit',
                        hour12: false
                    });

                    const item = document.createElement('div');
                    item.className = 'gallery-item';
                    item.innerHTML = `
                        <img src="${e.target.result}" alt="Evidence ${grid.children.length + 1}">
                        <div class="gallery-item-timestamp">LOGGED: ${timestamp}</div>
                    `;
                    grid.appendChild(item);
                };

                reader.readAsDataURL(file);
            }
        }

        fetchIPAddress();
        detectDeviceType();
        displayLastSeen();
        initialComplianceLevel();

        // Update last seen every second
        setInterval(displayLastSeen, 1000);

        // Attach analyze evidence listener
        const analyzeBtn = document.getElementById('analyzeEvidenceBtn');
        if (analyzeBtn) {
            analyzeBtn.addEventListener('click', recalculateComplianceFromEvidence);
        }

        // Initialize personality test
        renderPersonalityTest();
        updateTestProgress();

        // Attach personality test listeners
        const testForm = document.getElementById('personalityTestForm');
        if (testForm) {
            testForm.addEventListener('change', function(e) {
                if (e.target.type === 'radio') {
                    updateTestProgress();
                    setTimeout(showNextQuestion, 300);
                }
            });
        }

        const submitTestBtn = document.getElementById('submitTestBtn');
        if (submitTestBtn) {
            submitTestBtn.addEventListener('click', handlePersonalitySubmit);
        }
    </script>
</body>
</html>